 # 前端功能测试指南

## 概述

本文档说明如何测试新实现的发布版本管理功能。

## 环境准备

### 1. 启动后端服务
```bash
cd Server
mvn spring-boot:run
```

### 2. 启动前端服务
```bash
cd H5
npm run dev
```

### 3. 访问前端应用
打开浏览器访问：http://127.0.0.1:3000/

## 功能测试

### 1. 登录系统
- 输入API密钥：`your-secret-api-key`
- 输入服务器地址：`http://localhost:8080`
- 点击"连接"按钮

### 2. 应用管理功能测试

#### 2.1 查看应用列表
- 左侧显示所有应用列表
- 可以使用搜索框搜索应用
- 点击应用可查看详情

#### 2.2 强制更新设置（应用级别）
- 选择一个应用
- 在右侧"安装设置"区域可以看到"是否强制更新"开关
- 切换开关可以设置应用级别的强制更新

#### 2.3 版本列表管理
- 在"版本列表"区域可以看到所有版本
- 每个版本显示：版本号、Build号、大小、下载次数、更新时间、更新说明
- 当前发布版本会显示绿色的"当前发布版本"标签

#### 2.4 设置发布版本
- 对于非发布版本，会显示绿色的"设为发布版本"按钮
- 点击按钮会弹出确认对话框
- 确认后该版本会成为新的发布版本，之前的发布版本会被取消

#### 2.5 编辑版本信息
- 每个版本都有蓝色的"编辑"按钮
- 点击可以编辑版本的更新说明

### 3. 上传新版本功能测试

#### 3.1 上传APK文件
- 点击"上传新版本"按钮
- 拖拽或选择APK文件
- 点击"开始上传"

#### 3.2 设置版本信息
- 上传成功后会显示APK信息
- 可以编辑版本更新说明
- 点击"发布版本"可以直接将新版本设为发布版本
- 点击"保存"仅保存版本信息但不设为发布版本

## 新功能特点

### 1. 发布版本管理
- 每个应用只能有一个发布版本
- 设置新的发布版本会自动取消之前的发布版本
- 移动端检查更新时只会获取发布版本

### 2. 应用级别强制更新
- 强制更新设置从版本级别改为应用级别
- 所有版本共享同一个强制更新设置

### 3. 版本状态简化
- 移除了复杂的状态管理（启用/禁用/测试）
- 只有发布/非发布两种状态
- 非发布版本作为历史记录保存

## API接口变更

### 新增接口
- `PUT /api/admin/app/{appId}/release-version/{versionId}` - 设置发布版本
- `PUT /api/admin/app/{appId}/force-update` - 更新应用强制更新设置
- `GET /api/admin/app/{appId}/release-version` - 获取当前发布版本

### 数据库变更
- `app_version` 表：移除 `status` 字段，新增 `is_released` 字段
- `app_info` 表：新增 `force_update` 字段

## 测试要点

1. **发布版本唯一性**：确保每个应用只能有一个发布版本
2. **强制更新应用级别**：确保强制更新设置影响整个应用
3. **版本历史保留**：确保非发布版本仍然保存在系统中
4. **移动端兼容性**：确保移动端检查更新API返回正确的发布版本
5. **UI交互流畅性**：确保所有按钮和操作响应正常

## 故障排除

### 常见问题
1. **API密钥验证失败**：检查后端服务是否启动，API密钥是否正确
2. **版本列表为空**：确保数据库中有测试数据
3. **上传失败**：检查文件格式是否为APK，大小是否超过限制
4. **设置发布版本失败**：检查后端日志，确认API接口正常工作

### 调试方法
1. 打开浏览器开发者工具查看网络请求
2. 查看后端控制台日志
3. 检查数据库数据变更情况