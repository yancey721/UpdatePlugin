# 移动端API接口文档

## 概述

移动端API用于Android应用检查更新和下载APK文件，无需认证即可访问。

### 基础URL

```
http://localhost:8080/api/app
```

### 通用响应格式

```json
{
    "code": 200,
    "message": "操作成功",
    "data": {},
    "timestamp": 1748589121124
}
```

## API接口列表

### 1. 检查更新

#### 1.1 检查应用更新
- **接口**: `POST /check-update`
- **描述**: 移动端检查应用是否有新版本可更新
- **认证**: 无需认证

**请求体**:
```json
{
    "appId": "com.unifysign.test",
    "currentVersionCode": 50
}
```

**参数说明**:
- `appId` (必填): 应用ID
- `currentVersionCode` (必填): 当前版本号

**响应示例 - 有更新**:
```json
{
    "code": 200,
    "message": "发现新版本",
    "data": {
        "hasUpdate": true,
        "newVersionName": "1.1.8001",
        "newVersionCode": 56,
        "updateDescription": "1. 修复已知问题\n2. 优化用户体验",
        "forceUpdate": false,
        "downloadUrl": "http://localhost:8080/api/app/download/com.unifysign.test-56.apk",
        "md5": "a1b2c3d4e5f6789012345678901234567890abcd",
        "fileSize": 15728640
    }
}
```

**响应示例 - 无更新**:
```json
{
    "code": 200,
    "message": "当前已是最新版本",
    "data": {
        "hasUpdate": false,
        "newVersionName": null,
        "newVersionCode": null,
        "updateDescription": null,
        "forceUpdate": false,
        "downloadUrl": null,
        "md5": null,
        "fileSize": null
    }
}
```

**响应字段说明**:
- `hasUpdate`: 是否有更新
- `newVersionName`: 新版本名称（如"1.2.0"）
- `newVersionCode`: 新版本号（整数）
- `updateDescription`: 更新说明
- `forceUpdate`: 是否强制更新
- `downloadUrl`: APK下载链接
- `md5`: APK文件MD5值，用于校验
- `fileSize`: APK文件大小（字节）

### 2. 文件下载

#### 2.1 下载APK文件
- **接口**: `GET /download/{fileName}`
- **描述**: 下载APK安装包文件
- **认证**: 无需认证

**路径参数**:
- `fileName` (字符串): APK文件名，如 `com.unifysign.test-56.apk`

**响应**:
- **成功**: 返回APK文件流，Content-Type为 `application/vnd.android.package-archive`
- **失败**: 返回404错误

**使用示例**:
```bash
curl -O "http://localhost:8080/api/app/download/com.unifysign.test-56.apk"
```

## 错误处理

### 常见错误码

- `400`: 请求参数错误
- `404`: 应用或文件不存在
- `500`: 服务器内部错误

### 错误响应格式

```json
{
    "code": 404,
    "message": "应用ID不存在: com.example.nonexistent",
    "data": null,
    "timestamp": 1748589121124
}
```

## 集成示例

### Android SDK集成示例

```java
// 检查更新
public void checkUpdate(String appId, int currentVersionCode) {
    CheckUpdateRequest request = new CheckUpdateRequest();
    request.setAppId(appId);
    request.setCurrentVersionCode(currentVersionCode);
    
    // 发送POST请求到 /api/app/check-update
    // 处理响应...
}

// 下载APK
public void downloadApk(String downloadUrl, String md5) {
    // 下载文件
    // 验证MD5
    // 安装APK
}
```

### 网络请求示例

```bash
# 检查更新
curl -X POST "http://localhost:8080/api/app/check-update" \
  -H "Content-Type: application/json" \
  -d '{
    "appId": "com.unifysign.test",
    "currentVersionCode": 50
  }'

# 下载APK
curl -O "http://localhost:8080/api/app/download/com.unifysign.test-56.apk"
```

## 注意事项

1. **版本比较**: 服务端会查找版本号大于 `currentVersionCode` 且状态为启用的最新版本
2. **文件校验**: 建议下载完成后使用MD5值校验文件完整性
3. **网络处理**: 建议在网络请求中添加超时和重试机制
4. **权限要求**: Android 8.0+需要"安装未知应用"权限才能安装APK 